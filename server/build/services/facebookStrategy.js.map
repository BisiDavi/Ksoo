{"version":3,"sources":["../../src/services/facebookStrategy.js"],"names":["serverUrl","process","env","NODE_ENV","SERVER_URL_PROD","SERVER_URL_DEV","facebookLogin","FacebookStrategy","clientID","FACEBOOK_APP_ID","clientSecret","FACEBOOK_SECRET","callbackURL","FACEBOOK_CALLBACK_URL","profileFields","accessToken","refreshToken","profile","done","oldUser","User","findOne","email","emails","value","err","console","log","newUser","provider","facebookId","id","username","name","displayName","avatar","photos","save","passport","use"],"mappings":";;AAAA;;AACA;;AAEA;;;;AAEA,MAAMA,SAAS,GAAGC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,GAAwCF,OAAO,CAACC,GAAR,CAAYE,eAApD,GAAsEH,OAAO,CAACC,GAAR,CAAYG,cAApG,C,CAEA;;AACA,MAAMC,aAAa,GAAG,IAAIC,0BAAJ,CACpB;AACEC,EAAAA,QAAQ,EAAEP,OAAO,CAACC,GAAR,CAAYO,eADxB;AAEEC,EAAAA,YAAY,EAAET,OAAO,CAACC,GAAR,CAAYS,eAF5B;AAGEC,EAAAA,WAAW,EAAG,GAAEZ,SAAU,GAAEC,OAAO,CAACC,GAAR,CAAYW,qBAAsB,EAHhE;AAIEC,EAAAA,aAAa,EAAE,CACb,IADa,EAEb,OAFa,EAGb,QAHa,EAIb,YAJa,EAKb,aALa,EAMb,QANa,EAOb,MAPa,EAQb,UARa,EASb,cATa,EAUb,UAVa,EAWb,qBAXa;AAJjB,CADoB,EAmBpB,OAAOC,WAAP,EAAoBC,YAApB,EAAkCC,OAAlC,EAA2CC,IAA3C,KAAoD;AAClD;AACA,MAAI;AACF,UAAMC,OAAO,GAAG,MAAMC,cAAKC,OAAL,CAAa;AAAEC,MAAAA,KAAK,EAAEL,OAAO,CAACM,MAAR,CAAe,CAAf,EAAkBC;AAA3B,KAAb,CAAtB;;AAEA,QAAIL,OAAJ,EAAa;AACX,aAAOD,IAAI,CAAC,IAAD,EAAOC,OAAP,CAAX;AACD;AACF,GAND,CAME,OAAOM,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,GAViD,CAYlD;;;AACA,MAAI;AACF,UAAMG,OAAO,GAAG,MAAM,IAAIR,aAAJ,CAAS;AAC7BS,MAAAA,QAAQ,EAAE,UADmB;AAE7BC,MAAAA,UAAU,EAAEb,OAAO,CAACc,EAFS;AAG7BC,MAAAA,QAAQ,EAAG,OAAMf,OAAO,CAACc,EAAG,EAHC;AAI7BT,MAAAA,KAAK,EAAEL,OAAO,CAACM,MAAR,CAAe,CAAf,EAAkBC,KAJI;AAK7BS,MAAAA,IAAI,EAAEhB,OAAO,CAACiB,WALe;AAM7BC,MAAAA,MAAM,EAAElB,OAAO,CAACmB,MAAR,CAAe,CAAf,EAAkBZ;AANG,KAAT,EAOnBa,IAPmB,EAAtB;AASAnB,IAAAA,IAAI,CAAC,IAAD,EAAOU,OAAP,CAAJ;AACD,GAXD,CAWE,OAAOH,GAAP,EAAY;AACZC,IAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD;AACF,CA9CmB,CAAtB;;AAiDAa,kBAASC,GAAT,CAAajC,aAAb","sourcesContent":["import passport from 'passport';\r\nimport { Strategy as FacebookStrategy } from 'passport-facebook';\r\n\r\nimport User from '../models/User';\r\n\r\nconst serverUrl = process.env.NODE_ENV === 'production' ? process.env.SERVER_URL_PROD : process.env.SERVER_URL_DEV;\r\n\r\n// facebook strategy\r\nconst facebookLogin = new FacebookStrategy(\r\n  {\r\n    clientID: process.env.FACEBOOK_APP_ID,\r\n    clientSecret: process.env.FACEBOOK_SECRET,\r\n    callbackURL: `${serverUrl}${process.env.FACEBOOK_CALLBACK_URL}`,\r\n    profileFields: [\r\n      'id',\r\n      'email',\r\n      'gender',\r\n      'profileUrl',\r\n      'displayName',\r\n      'locale',\r\n      'name',\r\n      'timezone',\r\n      'updated_time',\r\n      'verified',\r\n      'picture.type(large)',\r\n    ],\r\n  },\r\n  async (accessToken, refreshToken, profile, done) => {\r\n    // console.log(profile);\r\n    try {\r\n      const oldUser = await User.findOne({ email: profile.emails[0].value });\r\n\r\n      if (oldUser) {\r\n        return done(null, oldUser);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n\r\n    // register user\r\n    try {\r\n      const newUser = await new User({\r\n        provider: 'facebook',\r\n        facebookId: profile.id,\r\n        username: `user${profile.id}`,\r\n        email: profile.emails[0].value,\r\n        name: profile.displayName,\r\n        avatar: profile.photos[0].value,\r\n      }).save();\r\n\r\n      done(null, newUser);\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  },\r\n);\r\n\r\npassport.use(facebookLogin);\r\n"],"file":"facebookStrategy.js"}